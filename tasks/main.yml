---
# tasks file for /usr/local/google/home/friasc/apigee-workspace/apigee-opdk-role-workspace/apigee-server-restart
- name: Restarting node now
  become: yes
  shell: sleep 2 && reboot now
  async: 1
  poll: 0

- name: Waiting for server to complete restarting
  become: no
  local_action: wait_for
  args:
    host: '{{ inventory_hostname }}'
    port: 22
    state: started
    delay: "{{ server_restart_delay | d(15) }}"
    timeout: '{{ server_restart_timeout | d(60) }}'

- name: Report server started
  debug:
    msg: "Server is now running."
